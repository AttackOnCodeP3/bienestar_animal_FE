<app-general-container-component>
  <div class="d-flex justify-content-between align-items-center">
    <h1>
      Crear anuncios
    </h1>
    <button matButton="elevated">
      <mat-icon>arrow_back</mat-icon>
      Gestionar anuncios
    </button>
  </div>
</app-general-container-component>

<form [formGroup]="createAnnouncementForm" (ngSubmit)="onSubmit()">
  <app-general-container-component>
    <div class="row">
      <div class="col-12 mb-3">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>
            Titulo del anuncio
          </mat-label>
          <input
            matInput
            formControlName="title"
            [errorStateMatcher]="formsService.matcher"
          />
          @let titleControl = createAnnouncementForm.get('title');
          @if (formsService.isFieldInvalid(titleControl)) {
            <mat-error>{{ formsService.getErrorMessage(titleControl) }}</mat-error>
          }
        </mat-form-field>
      </div>
      <div class="col-12 mb-3">
        <mat-form-field class="w-100" appearance="outline">
          <mat-label>
            Descripción del anuncio
          </mat-label>
          <textarea
            matInput
            placeholder="Ingrese la descripción del anuncio"
            formControlName="description"
            [errorStateMatcher]="formsService.matcher"
          ></textarea>
          @let descriptionControl = createAnnouncementForm.get('description');
          @if (formsService.isFieldInvalid(descriptionControl)) {
            <mat-error>{{ formsService.getErrorMessage(descriptionControl) }}</mat-error>
          }
        </mat-form-field>
      </div>
    </div>
  </app-general-container-component>

  <app-general-container-component>
    <div class="row">
      <div class="col-lg-6">
        <mat-form-field class="w-100" appearance="outline">
          <mat-label>
            Fecha de inicio
          </mat-label>
          <input
            readonly
            matInput
            placeholder="Seleccione una fecha de inicio"
            [matDatepicker]="pickerStartDate"
            [min]="formsService.minDate3MonthsAgo"
            [max]="formsService.maxTodayDate"
            [errorStateMatcher]="formsService.matcher"
            formControlName="startDate"
          >
          <mat-datepicker-toggle matIconSuffix [for]="pickerStartDate"></mat-datepicker-toggle>
          <mat-datepicker #pickerStartDate></mat-datepicker>
          @let startDateControl = createAnnouncementForm.get('startDate');
          @if (formsService.isFieldInvalid(startDateControl)) {
            <mat-error>{{ formsService.getErrorMessage(startDateControl) }}</mat-error>
          }
        </mat-form-field>
      </div>
      <div class="col-lg-6">
        <mat-form-field class="w-100" appearance="outline">
          <mat-label>
            Fecha de finalización
          </mat-label>
          <input
            readonly
            matInput [matDatepicker]="pickerEndDate"
            [min]="formsService.minDate3MonthsAgo"
            [max]="formsService.maxTodayDate"
            [errorStateMatcher]="formsService.matcher"
            formControlName="endDate"
            placeholder="Seleccione una fecha de finalización"
          >
          <mat-datepicker-toggle matIconSuffix [for]="pickerEndDate"></mat-datepicker-toggle>
          <mat-datepicker #pickerEndDate></mat-datepicker>
          @let endDateControl = createAnnouncementForm.get('endDate');
          @if (formsService.isFieldInvalid(endDateControl)) {
            <mat-error>{{ formsService.getErrorMessage(endDateControl) }}</mat-error>
          }
        </mat-form-field>
      </div>
    </div>
  </app-general-container-component>

  <app-general-container-component>
    <div class="row">
      <div class="col-12">
        <mat-form-field class="w-100" appearance="outline">
          <mat-label>Estado del anuncio</mat-label>
          <mat-select
            formControlName="announcementState"
            [errorStateMatcher]="formsService.matcher"
            placeholder="Seleccione un estado"
          >
            <mat-option [value]="formsService.filterOptionEnum.SELECT_OPTION">
              Seleccione un estado
            </mat-option>
            @for (
              announcementState of announcementStateHttpService.announcementStatesList(); track announcementState.id) {
              <mat-option [value]="announcementState.id">{{ announcementState.name }}</mat-option>
            }
          </mat-select>
          @let announcementStateControl = createAnnouncementForm.get('announcementState');
          @if (formsService.isFieldInvalid(announcementStateControl)) {
            <mat-error>{{ formsService.getErrorMessage(announcementStateControl) }}</mat-error>
          }
        </mat-form-field>
      </div>
    </div>
  </app-general-container-component>

  <app-general-container-component>
    @let fileControl = createAnnouncementForm.get('file');
    <div class="row">
      <div class="col-12">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Fotografía del anuncio</mat-label>
          <ngx-mat-file-input
            placeholder="Seleccione una fotografía"
            formControlName="file"
            [errorStateMatcher]="formsService.matcher"
            [accept]="formsService.imageFileAcceptTypes"
          >
          </ngx-mat-file-input>
          <mat-icon matSuffix>folder</mat-icon>
          @if (formsService.isFieldInvalid(fileControl)) {
            <mat-error>{{ formsService.getErrorMessage(fileControl) }}</mat-error>
          }
        </mat-form-field>
      </div>
      @if (fileControl?.value) {
        <div class="mt-3 text-end">
          <button matButton="outlined" type="button" (click)="onViewImage()">
            <mat-icon>
              visibility
            </mat-icon>
            Ver imagen
          </button>
        </div>
      }
    </div>
  </app-general-container-component>

  <div class="text-end">
    <button matButton="tonal">Registrar</button>
  </div>
</form>





