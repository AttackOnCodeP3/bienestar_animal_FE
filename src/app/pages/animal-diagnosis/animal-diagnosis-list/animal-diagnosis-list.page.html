<app-general-container-component>
  <div class="d-flex justify-content-between align-items-center flex-wrap">
    <h1>{{ 'menu.viewAnimalDiagnosis' | translate }}</h1>
    <button
      matButton="elevated"
      class="mb-3"
      routerLink="../animal-diagnosis-create"
    >
      <mat-icon>add</mat-icon>
      {{ 'menu.createAnimalDiagnosis' | translate }}
    </button>
  </div>
</app-general-container-component>

<form [formGroup]="form" class="mb-4">
  <div class="row">
    <div class="col-lg-6 mb-3">
      <mat-form-field appearance="outline" class="w-100">
        <mat-label>{{ 'inputs.labels.animal' | translate }}</mat-label>
        <mat-select
          id="animal-select"
          formControlName="animalId"
          (selectionChange)="onAnimalChange()"
          required
        >
          <mat-option *ngFor="let animal of animals" [value]="animal.id">
            {{ animal.name }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>
  </div>
</form>

<div *ngIf="diagnosisService.loadingDiagnoses()" class="spinner-container">
  <mat-progress-spinner
    mode="indeterminate"
    diameter="48"
  ></mat-progress-spinner>
  <div>{{ 'loadingMessages.loading' | translate }}</div>
</div>
<div *ngIf="error" class="alert alert-danger my-4">{{ error }}</div>

<table
  mat-table
  [dataSource]="diagnoses"
  class="mat-elevation-z8"
  *ngIf="diagnoses.length"
>
  <ng-container matColumnDef="id">
    <th mat-header-cell *matHeaderCellDef>ID</th>
    <td mat-cell *matCellDef="let d">{{ d.id }}</td>
  </ng-container>
  <ng-container matColumnDef="imagenUrl">
    <th mat-header-cell *matHeaderCellDef>Foto</th>
    <td mat-cell *matCellDef="let d">
      <img
        [src]="d.imagenUrl"
        alt="Foto animal"
        style="max-width: 80px; border-radius: 8px"
      />
    </td>
  </ng-container>
  <ng-container matColumnDef="description">
    <th mat-header-cell *matHeaderCellDef>Descripci√≥n</th>
    <td mat-cell *matCellDef="let d">{{ d.description }}</td>
  </ng-container>
  <ng-container matColumnDef="createdAt">
    <th mat-header-cell *matHeaderCellDef>Fecha</th>
    <td mat-cell *matCellDef="let d">{{ d.createdAt | date:'short' }}</td>
  </ng-container>
  <ng-container matColumnDef="observacion">
    <th mat-header-cell *matHeaderCellDef>Resultado</th>
    <td mat-cell *matCellDef="let d">
      <div [innerHTML]="d.observacion"></div>
      <div *ngIf="showWarning(d)" class="text-warning mt-2">
        <strong>Advertencia:</strong> {{ getWarningText(d) }}
      </div>
    </td>
  </ng-container>
  <tr
    mat-header-row
    *matHeaderRowDef="['id', 'imagenUrl', 'description', 'createdAt', 'observacion']"
  ></tr>
  <tr
    mat-row
    *matRowDef="let row; columns: ['id', 'imagenUrl', 'description', 'createdAt', 'observacion']"
  ></tr>
</table>

<mat-paginator
  [length]="totalElements"
  [pageSize]="pageSize"
  [pageIndex]="pageIndex"
  [pageSizeOptions]="[5, 10, 25, 50]"
  (page)="onPageChange($event)"
  showFirstLastButtons="true"
>
</mat-paginator>

<div *ngIf="!diagnoses.length && !loading" class="my-4 text-center text-muted">
  {{ 'tables.noDataAvailable' | translate }}
</div>
